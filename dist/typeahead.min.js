/*!
 * typeahead.js 0.9.4
 * https://github.com/Svakinn/typeahead
 * Copyright 2013 Twitter, Inc. and other contributors; Licensed MIT
 */
(function(n){var u="0.9.4",t={isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(n){return!n||/^\s*$/.test(n)},escapeRegExChars:function(n){return n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(n){return typeof n=="string"},isNumber:function(n){return typeof n=="number"},isArray:n.isArray,isFunction:n.isFunction,isObject:n.isPlainObject,isUndefined:function(n){return typeof n=="undefined"},isEmpty:function(n){typeof n=="undefined"||n===null||n===""},bind:n.proxy,bindAll:function(t){var i;for(var r in t)n.isFunction(i=t[r])&&(t[r]=n.proxy(i,t))},indexOf:function(n,t){for(var i=0;i<n.length;i++)if(n[i]===t)return i;return-1},each:n.each,map:n.map,filter:n.grep,every:function(t,i){var r=!0;return t?(n.each(t,function(n,u){if(!(r=i.call(null,u,n,t)))return!1}),!!r):r},some:function(t,i){var r=!1;return t?(n.each(t,function(n,u){if(r=i.call(null,u,n,t))return!1}),!!r):r},mixin:n.extend,getUniqueId:function(){var n=1;return function(){return n++}}(),defer:function(n){setTimeout(n,0)},debounce:function(n,t,i){var r,u;return function(){var f=this,e=arguments,o,s;return o=function(){r=null;i||(u=n.apply(f,e))},s=i&&!r,clearTimeout(r),r=setTimeout(o,t),s&&(u=n.apply(f,e)),u}},throttle:function(n,t){var u,f,i,e,r,o;return r=0,o=function(){r=new Date;i=null;e=n.apply(u,f)},function(){var s=new Date,h=t-(s-r);return u=this,f=arguments,h<=0?(clearTimeout(i),i=null,r=s,e=n.apply(u,f)):i||(i=setTimeout(o,h)),e}},tokenizeQuery:function(t){return n.trim(t).toLowerCase().split(/[\s]+/)},tokenizeText:function(t){return n.trim(t).toLowerCase().split(/[\s\-_]+/)},getProtocol:function(){return location.protocol},noop:function(){}},i=function(){var n=/\s+/;return{on:function(t,i){var r;if(!i)return this;for(this._callbacks=this._callbacks||{},t=t.split(n);r=t.shift();)this._callbacks[r]=this._callbacks[r]||[],this._callbacks[r].push(i);return this},trigger:function(t,i){var u,f,r;if(!this._callbacks)return this;for(t=t.split(n);u=t.shift();)if(f=this._callbacks[u])for(r=0;r<f.length;r+=1)f[r].call(this,{type:u,data:i});return this}}}(),r=function(){function i(t){t&&t.el||n.error("EventBus initialized without el");this.$el=n(t.el)}var r="typeahead:";return t.mixin(i.prototype,{trigger:function(n){var t=[].slice.call(arguments,1);this.$el.trigger(r+n,t)}}),i}(),f=function(){function r(n){this.prefix=["__",n,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+this.prefix)}function u(){return(new Date).getTime()}function f(n){return JSON.stringify(t.isUndefined(n)?null:n)}function e(n){return JSON.parse(n)}var n,i;try{n=window.localStorage;n.setItem("~~~","!");n.removeItem("~~~")}catch(o){n=null}return i=n&&window.JSON?{_prefix:function(n){return this.prefix+n},_ttlKey:function(n){return this._prefix(n)+this.ttlKey},get:function(t){return this.isExpired(t)&&this.remove(t),e(n.getItem(this._prefix(t)))},set:function(i,r,e){return t.isNumber(e)?n.setItem(this._ttlKey(i),f(u()+e)):n.removeItem(this._ttlKey(i)),n.setItem(this._prefix(i),f(r))},remove:function(t){return n.removeItem(this._ttlKey(t)),n.removeItem(this._prefix(t)),this},clear:function(){for(var r,i=[],u=n.length,t=0;t<u;t++)(r=n.key(t)).match(this.keyMatcher)&&i.push(r.replace(this.keyMatcher,""));for(t=i.length;t--;)this.remove(i[t]);return this},isExpired:function(i){var r=e(n.getItem(this._ttlKey(i)));return t.isNumber(r)&&u()>r?!0:!1}}:{get:t.noop,set:t.noop,remove:t.noop,clear:t.noop,isExpired:t.noop},t.mixin(r.prototype,i),r}(),e=function(){function n(n){t.bindAll(this);n=n||{};this.sizeLimit=n.sizeLimit||10;this.cache={};this.cachedKeysByAge=[]}return t.mixin(n.prototype,{get:function(n){return this.cache[n]},set:function(n,t){var i;this.cachedKeysByAge.length===this.sizeLimit&&(i=this.cachedKeysByAge.shift(),delete this.cache[i]);this.cache[n]=t;this.cachedKeysByAge.push(n)},clear:function(){this.cache={};this.cachedKeysByAge=[]}}),n}(),o=function(){function o(n){t.bindAll(this);n=t.isString(n)?{url:n}:n;i=i||new e;f=t.isNumber(n.maxParallelRequests)?n.maxParallelRequests:f||6;this.url=n.url;this.handler=n.handler=typeof n.handler=="function"?n.handler:null;this.wildcard=n.wildcard||"%QUERY";this.filter=n.filter;this.replace=n.replace;this.name=n.name;this.cacheKey=n.cacheKey;this.skipCache=n.skipCache;this.url&&(this.ajaxSettings={type:"get",cache:n.cache,timeout:n.timeout,dataType:n.dataType||"json",beforeSend:n.beforeSend});this._get=(/^throttle$/i.test(n.rateLimitFn)?t.throttle:t.debounce)(this._get,n.rateLimitWait||300)}function s(){r++}function h(){r--}function c(){return r<f}var r=0,u={},f,i;return t.mixin(o.prototype,{_get:function(t,r,u,f){function o(n){var t=s.filter?s.filter(n):n;r&&r(t);this.skipCache||i.set(f,n)}var s=this,e=[];return c()?this.handler?typeof Q!="undefined"?Q.when(this._sendRequest(u,e)).then(function(){return o(e),Q.resolve(!0)}):n.when(this._sendRequest(u,e)).then(function(){return o(e),n.Deferred().resolve()}):this._sendRequest(t).done(o):this.onDeckRequestArgs=[].slice.call(arguments,0)},_sendRequest:function(t,i){function e(){h();u[t]=null;r.onDeckRequestArgs&&(r._get.apply(r,r.onDeckRequestArgs),r.onDeckRequestArgs=null)}var r=this,f=u[t];return f||(s(),f=this.handler?Q?Q.when(this.handler(t,i)).then(function(){return e(),Q.resolve(!0)}):n.when(this.handler(t,i)).then(function(){return e(),n.Deferred().resolve()}):u[t]=n.ajax(t,this.ajaxSettings).always(e)),f},get:function(n,r){var o=this,s=encodeURIComponent(n||""),f,u,e;return r=r||t.noop,f=this.url?this.replace?this.replace(this.url,s):this.url.replace(this.wildcard,s):"",e=typeof this.cacheKey=="function"?this.cacheKey(n):this.cacheKey?this.cacheKey+"%_"+n:f,!this.skipCache&&(u=i.get(e))?t.defer(function(){r(o.filter?o.filter(u):u)}):this._get(f,r,n,e),!!u},clearCache:function(){this.skipCache||i.clear()}}),o}(),s=function(){function r(i){t.bindAll(this);t.isString(i.template)&&!i.engine&&n.error("no template engine specified");i.local||i.prefetch||i.remote||n.error("one of local, prefetch or remote is required");this.name=i.name||t.getUniqueId();this.limit=i.limit||5;this.minLength=i.minLength===0?0:i.minLength||1;this.cacheKeyFn=null;typeof i.cacheKey=="function"?(this.cacheKey=i.cacheKey(),this.cacheKeyFn=i.cacheKey):this.cacheKey=i.cacheKey?i.cacheKey:this.name;this.header=i.header;this.footer=i.footer;this.valueKey=i.valueKey||"value";this.nameKey=i.nameKey||this.valueKey;this.restrictInputToDatum=i.restrictInputToDatum;this.template=e(i.template,i.engine,this.nameKey);this.local=i.local;this.prefetch=i.prefetch;this.remote=i.remote;this.matcher=i.matcher;this.itemHash={};this.adjacencyList={};this.nameAdjacencyList={};this.storage=this.cacheKey?new f(this.cacheKey):null}function e(n,i,r){var u,f;return t.isFunction(n)?u=n:t.isString(n)?(f=i.compile(n),u=t.bind(f.render,f)):u=function(n){return"<p>"+n[r]+"<\/p>"},u}var i={thumbprint:"thumbprint",protocol:"protocol",itemHash:"itemHash",adjacencyList:"adjacencyList",nameAdjacencyList:"nameAdjacencyList"};return t.mixin(r.prototype,{_processLocalData:function(n){this._mergeProcessedData(this._processData(n))},_loadPrefetchData:function(r){function w(n,t,i){console.log("Prefetch error: "+i.message)}function c(n){var e=r.filter?r.filter(n):n,u=f._processData(e),o=u.itemHash,s=u.adjacencyList,h=u.nameAdjacencyList;f.storage&&(f.storage.set(i.itemHash,o,r.ttl),f.storage.set(i.adjacencyList,s,r.ttl),f.storage.set(i.nameAdjacencyList,h,r.ttl),f.storage.set(i.thumbprint,l,r.ttl),f.storage.set(i.protocol,t.getProtocol(),r.ttl));f._mergeProcessedData(u)}var f=this,l=u+(r.thumbprint||""),a,v,o,s,h,y=!0,e;if(r=t.isString(r)?{url:r}:r,r.ttl=t.isNumber(r.ttl)?r.ttl:864e5,!r.skipCache&&r.ttl>0&&(this.storage&&(a=this.storage.get(i.thumbprint),v=this.storage.get(i.protocol),o=this.storage.get(i.itemHash),s=this.storage.get(i.adjacencyList),h=this.storage.get(i.nameAdjacencyList)),y=a!==l||v!==t.getProtocol()),!r.skipCache&&r.ttl>0&&o&&s&&h&&!y)this._mergeProcessedData({itemHash:o,adjacencyList:s,nameAdjacencyList:h}),e=n.Deferred().resolve();else if(r.prefetchHandler&&typeof r.prefetchHandler=="function"){typeof Q!="undefined"?(e=n.Deferred(),Q.when(r.prefetchHandler()).then(p).fail(function(){e.resolve()})):e=n.when(r.prefetchHandler()).done(c);function p(n){return c(n),e.resolve(),Q.resolve(!0)}}else r.url&&(e=n.getJSON(r.url).done(c).fail(w));return e},_transformDatum:function(n){var r=t.isString(n)?n:n[this.valueKey],u=t.isString(n)?n:n[this.nameKey],f=n.tokens||t.tokenizeText(r),i={value:r,name:u,tokens:f,dsname:this.name};return t.isString(n)?(i.datum={},i.datum[this.valueKey]=n):i.datum=n,i},_processData:function(n){var f=this,u={},i={},r={};return t.each(n,function(n,e){var s=f._transformDatum(e),o=t.getUniqueId(s.value),h;u[o]=s;h=s.name.charAt(0).toLowerCase();nameAdjacency=r[h]||(r[h]=[o]);~t.indexOf(nameAdjacency,o)||nameAdjacency.push(o);t.each(s.tokens,function(n,r){var u=r.charAt(0).toLowerCase();adjacency=i[u]||(i[u]=[o]);~t.indexOf(adjacency,o)||adjacency.push(o)})}),{itemHash:u,adjacencyList:i,nameAdjacencyList:r}},_mergeProcessedData:function(n){var i=this;t.mixin(this.itemHash,n.itemHash);t.each(n.adjacencyList,function(n,t){var r=i.adjacencyList[n];i.adjacencyList[n]=r?r.concat(t):t});t.each(n.nameAdjacencyList,function(n,t){var r=i.nameAdjacencyList[n];i.nameAdjacencyList[n]=r?r.concat(t):t})},_getLocalSuggestions:function(n){var f=[],h=t.escapeRegExChars(n.toLowerCase()),e,r=0,l=new RegExp("^"+h,"i"),a,o,s,i,u,v,c;if(t.isEmpty(n))a=this.limit,t.each(this.itemHash,function(n,t){return f.push(t),r++,r==a?!1:void 0});else{if(o=this.nameAdjacencyList[h.charAt(0)],o)for(e=o.length,i=0;i<e;i++)if(u=this.itemHash[o[i]],u.name.search(l)===0&&(f.push(u),r++),r==this.limit)break;if(r<this.limit){if(s=this.adjacencyList[h.charAt(0)],!s)return f;for(e=s.length,i=0;i<e;i++)if(u=this.itemHash[s[i]],v=t.some(u.tokens,function(n){return n.search(l)===0}),v&&(c=!1,t.each(f,function(n,t){if(t.value==u.value)return c=!0,!1}),!c&&(f.push(u),r++,r==this.limit)))break}}return f},initialize:function(){var t;return this.local&&this._processLocalData(this.local),this.remote&&typeof this.remote=="function"&&(this.remote={handler:this.remote}),this.prefetch&&typeof this.prefetch=="function"&&(this.prefetch={prefetchHandler:this.prefetch}),!this.remote||this.remote.url||this.remote.cacheKey||this.remote.name||(this.remote.cacheKey=this.cacheKey||this.remote.name||this.name),this.transport=this.remote?new o(this.remote):null,this.isRemote=this.remote?!0:!1,t=this.prefetch?this._loadPrefetchData(this.prefetch):n.Deferred().resolve(),this.initialize=function(){return t},t},getSuggestions:function(n,i){function e(n){r=r.slice(0);t.each(n,function(n,i){var f=u._transformDatum(i),e;return e=t.some(r,function(n){return f.value===n.value}),e||r.push(f),r.length<u.limit});i&&i(r)}var u=this,r,f=!1;n.length<this.minLength||(this.matcher&&typeof this.matcher=="function"?suggestons=this.matcher(n,this):r=this._getLocalSuggestions(n),this.transport&&(f=this.transport.get(n,e)),!f&&i&&i(r))},reload:function(){var t;return this.cacheKeyFn&&(t=this.cacheKey,this.cacheKey=this.cacheKeyFn(),this.cacheKey!=t&&this.clearCache()),this.itemHash={},this.adjacencyList={},this.nameAdjacencyList={},this.local&&this._processLocalData(this.local),this.prefetch?this._loadPrefetchData(this.prefetch):n.Deferred().resolve()},clearCache:function(){this.storage&&this.storage.clear();this.transport&&this.transport.clearCache()}}),r}(),h=function(){function r(i){var r=this;if(t.bindAll(this),this.specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},this.tracer=i.tracer,this.isFocused=!1,this.$hint=n(i.hint),this.$input=n(i.input).on("blur.tt",this._handleBlur).on("focus.tt",this._handleFocus).on("keydown.tt",this._handleSpecialKeyEvent),t.isMsie())this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(n){r.specialKeyCodeMap[n.which||n.keyCode]||t.defer(r._compareQueryToInputValue)});else this.$input.on("input.tt",this._compareQueryToInputValue);this.query=this.$input.val();this.$overflowHelper=u(this.$input)}function u(t){return n("<span><\/span>").css({position:"absolute",left:"-9999px",visibility:"hidden",whiteSpace:"nowrap",fontFamily:t.css("font-family"),fontSize:t.css("font-size"),fontStyle:t.css("font-style"),fontVariant:t.css("font-variant"),fontWeight:t.css("font-weight"),wordSpacing:t.css("word-spacing"),letterSpacing:t.css("letter-spacing"),textIndent:t.css("text-indent"),textRendering:t.css("text-rendering"),textTransform:t.css("text-transform")}).insertAfter(t)}function f(n,t){return n=(n||"").replace(/^\s*/g,"").replace(/\s{2,}/g," "),t=(t||"").replace(/^\s*/g,"").replace(/\s{2,}/g," "),n===t}return t.mixin(r.prototype,i,{_handleFocus:function(){this.isFocused=!0;this.trigger("focused")},_handleBlur:function(){this.isFocused=!1;this.trigger("blured")},_handleSpecialKeyEvent:function(n){var t=this.specialKeyCodeMap[n.which||n.keyCode];t&&this.trigger(t+"Keyed",n)},_compareQueryToInputValue:function(){var n=this.getInputValue(),t=f(this.query,n);t||this.trigger("queryChanged",{value:this.query=n})},destroy:function(){this.$hint.off(".tt");this.$input.off(".tt");this.$hint=this.$input=this.$overflowHelper=null},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(n){this.query=n},getInputValue:function(){return this.$input.val()},setInputValue:function(n,t){this.$input.val(n);t||this._compareQueryToInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(n){this.$hint.val(n)},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},isOverflow:function(){return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>this.$input.width()},isCursorAtEnd:function(){var n=this.$input.val().length,r=this.$input[0].selectionStart,i;return t.isNumber(r)?r===n:document.selection?(i=document.selection.createRange(),i.moveStart("character",-n),n===i.text.length):!0},hasFocus:function(){return this.isFocused||this.$input.is(":focus")}}),r}(),c=function(){function f(i){t.bindAll(this);this.tracer=i.tracer;this.isOpen=!1;this.isEmpty=!0;this.isMouseOverDropdown=!1;this.$menu=n(i.menu).on("mousedown.tt",this._handleMouseDown).on("mouseenter.tt",this._handleMouseenter).on("mouseleave.tt",this._handleMouseleave).on("click.tt",".tt-suggestion",this._handleSelection).on("mouseover.tt",".tt-suggestion",this._handleMouseover)}function r(n){return n.data("suggestion")}var e={suggestionsList:'<span class="tt-suggestions"><\/span>'},u={suggestionsList:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"}};return t.mixin(f.prototype,i,{_handleMouseenter:function(){this.isMouseOverDropdown=!0},_handleMouseleave:function(){this.isMouseOverDropdown=!1},_handleMouseover:function(t){var i=n(t.currentTarget);this._getSuggestions().removeClass("tt-is-under-cursor");i.addClass("tt-is-under-cursor")},_handleMouseDown:function(n){n.preventDefault()},_handleSelection:function(t){var i=n(t.currentTarget);this.trigger("suggestionSelected",r(i))},_show:function(){this.$menu.css("display","block")},_hide:function(){this.$menu.hide()},_moveCursor:function(n){var i,u,t,f;if(this.isVisible()){if(i=this._getSuggestions(),u=i.filter(".tt-is-under-cursor"),u.removeClass("tt-is-under-cursor"),t=i.index(u)+n,t=(t+1)%(i.length+1)-1,t===-1){this.trigger("cursorRemoved");return}t<-1&&(t=i.length-1);f=i.eq(t).addClass("tt-is-under-cursor");this._ensureVisibility(f);this.trigger("cursorMoved",r(f))}},_getSuggestions:function(){return this.$menu.find(".tt-suggestions > .tt-suggestion")},_ensureVisibility:function(n){var i=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),r=this.$menu.scrollTop(),t=n.position().top,u=t+n.outerHeight(!0);t<0?this.$menu.scrollTop(r+t):i<u&&this.$menu.scrollTop(r+(u-i))},destroy:function(){this.$menu.off(".tt");this.$menu=null},isVisible:function(){return this.isOpen&&!this.isEmpty},closeUnlessMouseIsOverDropdown:function(){this.isMouseOverDropdown||this.close()},close:function(){this.isOpen&&(this.isOpen=!1,this.isMouseOverDropdown=!1,this._hide(),this.$menu.find(".tt-suggestions > .tt-suggestion").removeClass("tt-is-under-cursor"),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,this._show(),this.trigger("opened"))},setLanguageDirection:function(n){n==="ltr"?this.$menu.css({left:"0",right:"auto"}):this.$menu.css({left:"auto",right:" 0"})},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getSuggestionUnderCursor:function(){var n=this._getSuggestions().filter(".tt-is-under-cursor").first();return n.length>0?r(n):null},renderSuggestions:function(i,r){var c="tt-dataset-"+i.name,v='<div class="tt-suggestion">%body<\/div>',l,a,f=this.$menu.find("."+c),o,s,h;f.length===0&&(a=n(e.suggestionsList).css(u.suggestionsList),f=n("<div><\/div>").addClass(c).append(i.header).append(a).append(i.footer).appendTo(this.$menu));r.length>0?(this.isEmpty=!1,this.isOpen&&this._show(),o=document.createElement("div"),s=document.createDocumentFragment(),t.each(r,function(t,r){l=i.template(r.datum);o.innerHTML=v.replace("%body",l);h=n(o.firstChild).css(u.suggestion).data("suggestion",r);h.children().each(function(){n(this).css(u.suggestionChild)});s.appendChild(h[0])}),f.show().find(".tt-suggestions").html(s)):this.clearSuggestions(i.name);this.trigger("suggestionsRendered")},clearSuggestions:function(n){var t=n?this.$menu.find(".tt-dataset-"+n):this.$menu.find('[class^="tt-dataset-"]'),i=t.find(".tt-suggestions");t.hide();i.empty();this._getSuggestions().length===0&&(this.isEmpty=!0,this._hide())},_findSuggestion:function(i){var f=this._getSuggestions(),u=null;return t.each(f,function(t,f){var e=r(n(f));if(e&&e.value===i)return u=n(f),!1}),u},_findFirstSuggestion:function(i){var f=this._getSuggestions(),u={element:null,data:null};return t.each(f,function(t,f){var e=r(n(f));if(e&&i.toLowerCase()===e.name.substring(0,i.length).toLowerCase())return u.element=n(f),u.data=e,!1}),u},highlightSuggestion:function(n){this._getSuggestions().removeClass("tt-is-under-cursor");n&&n.addClass("tt-is-under-cursor")},highlightDatum:function(n){this._getSuggestions().removeClass("tt-is-current");n&&n.addClass("tt-is-current")}}),f}(),l=function(){function f(n){var r,u,f,i;if(t.bindAll(this),this.$node=e(n.input),this.selectedDatum=null,this.selectedDatumDsName=null,this.datasets=n.datasets,this.dir=null,this.eventBus=n.eventBus,this.hasRemote=!1,this.isBusy=!1,this.isLoading=!1,this.dsnameAny=null,this.restrictInputToDatum=null,this.tracer=null,this.dsIdx=[],this.minMinLength=null,this.datasets&&this.datasets.length>0)for(i=0;i<this.datasets.length;i++)this.dsIdx[this.datasets[i].name]=this.datasets[i],this.dsnameAny||(this.dsnameAny=this.datasets[i].name),this.datasets[i].isRemote&&(this.hasRemote=!0,this.dsnameAny=this.datasets[i].name),!this.restrictInputToDatum&&this.datasets[i].restrictInputToDatum&&(this.restrictInputToDatum=this.datasets[i].restrictInputToDatum),this.tracer||(this.tracer=this.datasets[i].tracer),(this.minMinLength===null||this.minMinLength>this.datasets[i].minLength)&&(this.minMinLength=this.datasets[i].minLength);this.tracer||(this.tracer=[]);r=this.$node.find(".tt-dropdown-menu");u=this.$node.find(".tt-query");f=this.$node.find(".tt-hint");this.dropdownView=new c({menu:r,tracer:this.tracer}).on("suggestionSelected",this._handleSelection).on("cursorMoved",this._clearHint).on("cursorMoved",this._setInputValueToSuggestionUnderCursor).on("cursorRemoved",this._setInputValueToQuery).on("cursorRemoved",this._updateHint).on("suggestionsRendered",this._updateHint).on("opened",this._updateHint).on("closed",this._clearHint).on("opened closed",this._propagateEvent);this.inputView=new h({input:u,hint:f,tracer:this.tracer}).on("focused",this._handleFocused).on("queryChanged",this._queryForSuggestions).on("escKeyed",this._closeDropdown).on("escKeyed",this._setInputValueToQuery).on("tabKeyed upKeyed downKeyed",this._managePreventDefault).on("upKeyed downKeyed",this._moveDropdownCursor).on("upKeyed downKeyed",this._openDropdown).on("enterKeyed tabKeyed",this._handleSelection).on("tabKeyed leftKeyed rightKeyed",this._autocomplete).on("blured",this._handleBlured)}function e(t){var f=n(u.wrapper),e=n(u.dropdown),i=n(t),o=n(u.hint);f=f.css(r.wrapper);e=e.css(r.dropdown);o.css(r.hint).css({backgroundAttachment:i.css("background-attachment"),backgroundClip:i.css("background-clip"),backgroundColor:i.css("background-color"),backgroundImage:i.css("background-image"),backgroundOrigin:i.css("background-origin"),backgroundPosition:i.css("background-position"),backgroundRepeat:i.css("background-repeat"),backgroundSize:i.css("background-size")});i.data("ttAttrs",{dir:i.attr("dir"),autocomplete:i.attr("autocomplete"),spellcheck:i.attr("spellcheck"),style:i.attr("style")});i.addClass("tt-query").attr({autocomplete:"off",spellcheck:!1}).css(r.query);try{i.attr("dir")||i.attr("dir","auto")}catch(s){}return i.wrap(f).parent().prepend(o).append(e)}function o(n){var i=n.find(".tt-query");t.each(i.data("ttAttrs"),function(n,r){t.isUndefined(r)?i.removeAttr(n):i.attr(n,r)});i.detach().removeData("ttAttrs").removeClass("tt-query").insertAfter(n);n.remove()}var u={wrapper:'<span class="twitter-typeahead"><\/span>',hint:'<input class="tt-hint" type="text" autocomplete="off" spellcheck="off" disabled>',dropdown:'<span class="tt-dropdown-menu"><\/span>'},r={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"},query:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"}};return t.isMsie()&&t.mixin(r.query,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),t.isMsie()&&t.isMsie()<=7&&(t.mixin(r.wrapper,{display:"inline",zoom:"1"}),t.mixin(r.query,{marginTop:"-1px"})),t.mixin(f.prototype,i,{_managePreventDefault:function(n){var t=n.data,i,u,r=!1;switch(n.type){case"tabKeyed":i=this.inputView.getHintValue();u=this.inputView.getInputValue();r=i&&i!==u;break;case"upKeyed":case"downKeyed":r=!t.shiftKey&&!t.ctrlKey&&!t.metaKey}r&&t.preventDefault()},_manageLeaving:function(){var n=this.inputView.getInputValue(),i=typeof this.restrictInputToDatum=="function"?this.restrictInputToDatum():this.restrictInputToDatum;t.isEmpty(n)?(!this.selectedDatum||this.selectedDatum[this.dsIdx[this.selectedDatumDsName].nameKey])&&(this.selectedDatum=null,this.eventBus.trigger("noSelect","")):this.selectedDatum&&n!=this.selectedDatum[this.dsIdx[this.selectedDatumDsName].nameKey]?i?this.inputView.setInputValue(this.selectedDatum[this.dsIdx[this.selectedDatumDsName].nameKey],!0):(this.selectedDatum=null,this.eventBus.trigger("noSelect",n)):this.selectedDatum||t.isEmpty(n)||(i&&this.inputView.setInputValue("",!0),this.eventBus.trigger("noSelect",n))},_setLanguageDirection:function(){var n=this.inputView.getLanguageDirection();n!==this.dir&&(this.dir=n,this.$node.css("direction",n),this.dropdownView.setLanguageDirection(n))},_updateHint:function(){var n={element:null,data:null},u=null,f;this.selectedDatum&&(f=this.dsIdx[this.selectedDatumDsName].valueKey,u=this.dropdownView._findSuggestion(this.selectedDatum[f]));this.dropdownView.highlightDatum(u);n=this.dropdownView._findFirstSuggestion(this.inputView.getInputValue());this.dropdownView.highlightSuggestion(n.element);var e=n.data?n.data.name:null,c=this.dropdownView.isVisible(),l=this.inputView.isOverflow(),i,o,s,h,r;e&&c&&!l&&(i=this.inputView.getInputValue(),o=i.replace(/\s{2,}/g," ").replace(/^\s+/g,""),s=t.escapeRegExChars(o),h=new RegExp("^(?:"+s+")(.*$)","i"),r=h.exec(e),this.inputView.setHintValue(i+(r?r[1]:"")))},_clearHint:function(){this.inputView.setHintValue("")},_clearSuggestions:function(){this.dropdownView.clearSuggestions()},_setInputValueToQuery:function(){this.inputView.setInputValue(this.inputView.getQuery())},_setInputValueToSuggestionUnderCursor:function(n){var t=n.data;this.inputView.setInputValue(t.name,!0)},_openDropdown:function(){this.dropdownView.isOpen||this._queryForSuggestions()},_closeDropdown:function(n){var t=n&&n.type?n.type:"close";this._handleBusy(!1,null);this.dropdownView[t==="blured"?"closeUnlessMouseIsOverDropdown":"close"]()},_moveDropdownCursor:function(n){var t=n.data;t.shiftKey||t.ctrlKey||t.metaKey||this.dropdownView[n.type==="upKeyed"?"moveCursorUp":"moveCursorDown"]()},_handleSelection:function(n){var t=null;t=n.data&&n.data.hasOwnProperty("datum")?n.data:this.dropdownView.getSuggestionUnderCursor();t&&(this.inputView.setQuery(t.name),this.inputView.setInputValue(t.name,!0),this.selectedDatumDsName=t.dsname,this.selectedDatum=t.datum,this._clearSuggestions(),this._handleBusy(!1,null),this.dropdownView.close(),this.eventBus.trigger("selected",t.datum,t.dsname))},_handleBusy:function(n,t){var r=this.isBusy===!0||this.isLoading===!0,i;r||n!==!0&&t!==!0?r&&(n===!1||t===!1)&&(i=!0,this.isBusy===!0&&n!==!1&&(i=!1),this.isLoading===!0&&t!==!1&&(i=!1),i&&this.eventBus.trigger("busyUpdate",!1)):this.eventBus.trigger("busyUpdate",!0);n!==null&&(this.isBusy=n);t!==null&&(this.isLoading=t)},_handleFocused:function(){this.inputView.isFocused=!0;this._queryForSuggestions()},_handleBlured:function(n){this.inputView.isFocused=!1;this._closeDropdown(n);this._setInputValueToQuery();this._manageLeaving(n)},_queryForSuggestions:function(){this._clearHint();this._clearSuggestions();var n=this,i=this.inputView.getQuery();this.minMinLength!==0&&t.isBlankString(i)||(this._handleBusy(!0,null),t.each(this.datasets,function(t,r){r.getSuggestions(i,function(t){i===n.inputView.getQuery()&&n.inputView.hasFocus()&&(n._setLanguageDirection,n.dropdownView.open(),n.dropdownView.renderSuggestions(r,t))})}),i===n.inputView.getQuery()&&this._handleBusy(!1,null))},_autocomplete:function(n){var u,f,i,r,t;(n.type!=="rightKeyed"&&n.type!=="leftKeyed"||(u=this.inputView.isCursorAtEnd(),f=this.inputView.getLanguageDirection()==="ltr"?n.type==="leftKeyed":n.type==="rightKeyed",u&&!f))&&(i=this.inputView.getQuery(),r=this.inputView.getHintValue(),r!==""&&i!==r&&(t=this.dropdownView._findFirstSuggestion(i),this.selectedDatum=t.data.datum,this.selectedDatumDsName=t.data.dsname,this.inputView.setInputValue(t.data.name),this.eventBus.trigger("autocompleted",t.data.datum,t.data.dsname)))},_propagateEvent:function(n){this.eventBus.trigger(n.type)},destroy:function(){this.inputView.destroy();this.dropdownView.destroy();o(this.$node);this.$node=null},setQuery:function(n){this.inputView.setQuery(n);this.inputView.setInputValue(n);this._clearHint();this._clearSuggestions();this.inputView.hasFocus()&&this._queryForSuggestions()},setDatum:function(n,t){t=t?t:this.dsnameAny;typeof t!="undefined"&&this.dsIdx[t].nameKey&&(this.selectedDatumDsName=t,this.selectedDatum=n,query=n?n[this.dsIdx[t].nameKey]:"",this.inputView.setQuery(query),this.inputView.setInputValue(query),this._clearHint(),this._clearSuggestions(),this.inputView.hasFocus()&&this._queryForSuggestions())}}),f}();(function(){var i="ttView",u;u={initialize:function(u){function o(){var u=n(this),o;eventBus=new r({el:u});u.data(i,new l({input:u,eventBus:eventBus=new r({el:u}),datasets:e}));f=n(this).data(i);f._handleBusy(null,!0);o=t.map(e,function(n){return n.initialize()});n.when.apply(n,o).always(function(){t.defer(function(){f.inputView&&f.inputView.hasFocus()&&f._queryForSuggestions();f._handleBusy(null,!1);eventBus.trigger("initialized")})})}var e,f;return u=t.isArray(u)?u:[u],u.length===0&&n.error("no datasets provided"),e=t.map(u,function(n){return new s(n)}),this.each(o)},reload:function(){function e(){var i=r&&r.datasets?r.datasets:null;return r._handleBusy(null,!0),r._clearSuggestions(),u=t.map(i,function(n){return n.reload()}),n.when.apply(n,u).always(function(){t.defer(function(){r&&r.inputView&&r.inputView.hasFocus()&&r._queryForSuggestions();r._handleBusy(null,!1);eventBus.trigger("reloaded")})}),u}var f=n(this),u,r=f.data(i);return this.each(e)},destroy:function(){function t(){var t=n(this),r=t.data(i);(r=$input.data(i))&&(r.destroy(),t.removeData(i))}return this.each(t)},setQuery:function(t){var r=n(this).data(i);r&&r.setQuery(t)},setDatum:function(t,r){var u=n(this).data(i);u&&u.setDatum(t,r)},getDatum:function(){var t=n(this).data(i);return t&&t.selectedDatum},getQuery:function(){var t=n(this).data(i);return t&&t.inputView.getInputValue()},clearCache:function(){function f(n,t){t.clearCache()}var r=n(this).data(i),u=r&&r.datasets?r.datasets:null;t.each(u,f)},openDropdown:function(){var t=n(this).data(i);t&&t._openDropdown()},closeDropdown:function(){var t=n(this).data(i);t&&t._closeDropdown()}};jQuery.fn.typeahead=function(n){return u[n]?u[n].apply(this,[].slice.call(arguments,1)):u.initialize.apply(this,arguments)}})()})(window.jQuery);
