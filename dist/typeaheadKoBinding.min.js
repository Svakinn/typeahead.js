ko.typeaheadDatumGenerate=function(e,t,n,r,i){if(!e)return null;r=r||"value";if(r=="data")$.error("The name 'data' is reserved by tha bndnghandler and cannot be used as 'valueKey'");i=i||"name";if(i=="data")$.error("The name 'data' is reserved by tha bndnghandler and cannot be used as 'nameKey'");var s={};var o=[];var u=[];var a=n.split(",");if(!t){u.push(r);if(r!=i)u.push(r)}else u=t.split(",");s[r]=ko.unwrap(e[r]);s[i]=ko.unwrap(e[i]);s["data"]=e;for(var f=0;f<a.length;f++){if(a[f].trim()=="data")$.error("The name 'data' is reserved by tha bndnghandler and cannot be used in 'valueFields'");s[a[f].trim()]=ko.unwrap(e[a[f].trim()])}for(var f=0;f<u.length;f++)if(u[f].trim()){var l=ko.unwrap(e[u[f].trim()]);if(l){var c=false;for(var h=0;h<o.length;h++)if(o[h]==l){c=true;break}if(!c)o.push(ko.unwrap(e[u[f].trim()]))}}s["tokens"]=o;return s};ko.typeaheadPreFilter=function(e,t,n,r,i,s){var o;var u;if(s&&typeof s=="function"){o=s(e);u=ko.unwrap(o)}else u=ko.unwrap(e);var a=[];if(u){for(var f=0;f<u.length;f++)a.push(ko.typeaheadDatumGenerate(u[f],t,n,r,i))}return a};ko.bindingHandlers.typeahead={update:function(e,t,n,r,i){var s=t();var o=ko.unwrap(s.valueKey);var u=ko.unwrap(s.nameKey)||o;var a=ko.unwrap(s.tokenFields)||"";var f=ko.unwrap(s.valueFields)||"";if(s.hasOwnProperty("selectedDatum")){if(e&&typeof $(e).typeahead=="function"){var l=ko.unwrap(s.selectedDatum);var c=ko.typeaheadDatumGenerate(l,a,f,o,u);var h=$(e).typeahead("getDatum");if(h&&l&&o){if(h[o]!=c[o])$(e).typeahead("setDatum",c);else{if($(e).val()!=c[u])$(e).val(c[u])}}else if(h||c)$(e).typeahead("setDatum",c)}}},init:function(e,t,n,r,i){function Et(e,t){if(e.selectedDatum&&t&&t.hasOwnProperty("data"))e.selectedDatum(t.data);else e.selectedDatum(null)}var s=t();if(!$.isArray(s)){s=[s]}var o=[];var u,a,f,l,c,h,p,d;var v=s.length;for(var m=0;m<v;m++){g=s[m];var g=t();var y=ko.unwrap(g.name);var b=ko.unwrap(g.minLength);var w=ko.unwrap(g.valueKey);var E=ko.unwrap(g.nameKey)||w;var S=ko.unwrap(g.cacheKey);var x=ko.unwrap(g.skipCache);var T=ko.unwrap(g.limit);var N=g.restrictInputToDatum;var C=ko.unwrap(g.template);var k=ko.unwrap(g.templateElement);var L=ko.unwrap(g.tokenFields)||"";var A=ko.unwrap(g.valueFields)||"";var O=ko.unwrap(g.engine);var M=ko.unwrap(g.header);var _=ko.unwrap(g.footer);var D=ko.unwrap(g.local);var P=ko.unwrap(g.matcher);var H=ko.unwrap(g.prefetch);var B=ko.unwrap(g.remote);var j=ko.unwrap(g.url);var F=ko.unwrap(g.ttl);var I=ko.unwrap(g.filter);var q=ko.unwrap(g.dataType);var R=ko.unwrap(g.cache);var U=ko.unwrap(g.timeout);var z=ko.unwrap(g.wildcard);var W=ko.unwrap(g.replace);var X=ko.unwrap(g.rateLimitFn);var V=ko.unwrap(g.rateLimitWait);var J=ko.unwrap(g.maxParallelRequests);var K=ko.unwrap(g.beforeSend);var Q=ko.unwrap(g.handler);var G=ko.unwrap(g.prefetchHandler);var Y=ko.unwrap(g.autoSelect);var Z=ko.unwrap(g.floatDropdown);u=g.selectedDatum;a=g.isBusy;f=ko.unwrap(g.onAutoCompleted);l=ko.unwrap(g.onSelected);h=ko.unwrap(g.onOpened);p=ko.unwrap(g.onClosed);d=ko.unwrap(g.onInitialized);c=ko.unwrap(g.onNoSelect);var et={};if(y)et.name=y;if(w)et.valueKey=w;if(!w)$.error("The 'valueKey' opton is requied by this binding handler!");if(E)et.nameKey=E;if(N)et.restrictInputToDatum=N;if(S)et.cacheKey=S;if(T)et.limit=T;if(b||b===0)et.minLength=b;if(k)et.template=$(k).html();else if(C)et.template=C;if(O)et.engine=O;if(M)et.header=M;if(_)et.footer=_;if(D)et.local=ko.typeaheadPreFilter(D,L,A,w,E,I);if(P)et.matcher=P;if(Y||Y===false)et.autoSelect=Y;if(Z||Z===false)et.floatDropdown=Z;var tt=null;var nt=null;var rt=null;if(H||G){var it={};function st(e){return ko.typeaheadPreFilter(e,L,A,w,E,tt)}if(G)it.prefetchHandler=G;else if(typeof H=="function")it.prefetchHandler=H;else if(typeof H=="string"||typeof H=="object"&&H.constructor===String)it.url=H;else if(typeof H=="object"){nt=ko.unwrap(H.url);rt=ko.unwrap(H.prefetchHandler);var ot=ko.unwrap(H.ttl);var ut=ko.unwrap(H.skipCache);tt=ko.unwrap(H.filter);if(rt)it.prefetchHandler=rt;else if(nt)it.url=nt;if(ot)it.ttl=ot;if(ut||ut===false)it.skipCache=ut}if(I&&!tt)tt=I;if(G&&!it.prefetchHandler&&!it.url)it.prefetchHandler=G;if(j&&!it.url)it.url=j;if(F&&!it.ttl)it.ttl=F;if(x&&!(it.skipCache||it.skipCache===false))it.skipCache=x;it.filter=st;et.prefetch=it}if(B||Q){var at={};if(B&&typeof B=="function")at.handler=B;else if(Q||typeof Q=="function")at.handler=Q;else if(Q)at.url=Q;else if(typeof B=="string"||typeof B=="object"&&B.constructor===String)at.url=B;else if(typeof B=="object"){nt=ko.unwrap(B.url);rt=ko.unwrap(B.handler);var ft=ko.unwrap(B.url);var lt=ko.unwrap(B.cache);var ct=ko.unwrap(B.cacheKey);var ht=ko.unwrap(B.skipCache);var pt=ko.unwrap(B.timeout);var dt=ko.unwrap(B.wildcard);var vt=ko.unwrap(B.replace);var mt=ko.unwrap(B.rateLimitFn);var gt=ko.unwrap(B.rateLimitWait);var yt=ko.unwrap(B.maxParallelRequests);var bt=ko.unwrap(B.beforeSend);tt=ko.unwrap(B.filter);if(nt)at.url=nt;if(ft)at.dataType=ft;if(lt)at.cache=lt;if(lt)at.cacheKey=ct;if(ht||ht===false)at.skipCache=ht;if(pt)at.timeout=pt;if(dt)at.wildcard=dt;if(vt)at.replace=vt;if(mt)at.rateLimitFn=mt;if(gt)at.rateLimitWait=gt;if(yt)at.maxParallelRequests=yt;if(bt)at.beforeSend=bt;if(I&&!tt)tt=I}function wt(e){return ko.typeaheadPreFilter(e,L,A,w,E,tt)}if(j&&!at.url)at.url=j;if(Q&&!at.handler)at.handler=Q;if(q&&!at.url)at.dataType=q;if(R&&!at.url)at.cache=R;if(S&&!at.cacheKey)at.cacheKey=S;if((x||x===false)&&!at.skipCache&&at.skipCache!==false)at.skipCache=x;if(U&&!at.timeout)at.timeout=U;if(z&&!at.wildcard)at.wildcard=z;if(W&&!at.replace)at.replace=W;if(X&&!at.rateLimitFn)at.rateLimitFn=X;if(V&&!at.rateLimitWait)at.rateLimitWait=V;if(J&&!at.maxPerallelRequests)at.maxParallelRequests=J;if(K&&!at.beforeSend)at.beforeSend=K;at.filter=wt;et.remote=at}if(!y)et.name=e.id;if(et.template&&!et.engine&&Hogan)et.engine=Hogan;et.tracer=[];o.push(et)}$(e).attr("autocomplete","off");$(e).typeahead(o);if(f)$(e).on("typeahead:autocompleted",f);if(l)$(e).on("typeahead:selected",l);if(h)$(e).on("typeahead:opened",h);if(p)$(e).on("typeahead:closed",p);if(d)$(e).on("typeahead:initialized",d);if(c)$(e).on("typeahead:noSelect",c);if(u){$(e).on("typeahead:autocompleted typeahead:selected",function(e,n){Et(t(),n)});$(e).on("typeahead:noSelect",function(e,n){Et(t(),null)})}if(a){$(e).on("typeahead:busyUpdate",function(e,n){t().isBusy(n)})}}};
