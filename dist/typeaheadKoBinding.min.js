ko.typeaheadDatumGenerate=function(e,t,n,r,i){if(!e)return null;r=r||"value";if(r=="data")$.error("The name 'data' is reserved by tha bndnghandler and cannot be used as 'valueKey'");i=i||"name";if(i=="data")$.error("The name 'data' is reserved by tha bndnghandler and cannot be used as 'nameKey'");var s={};var o=[];var u=[];var a=n.split(",");if(!t){u.push(r);if(r!=i)u.push(r)}else u=t.split(",");s[r]=ko.unwrap(e[r]);s[i]=ko.unwrap(e[i]);s["data"]=e;for(var f=0;f<a.length;f++){if(a[f].trim()=="data")$.error("The name 'data' is reserved by tha bndnghandler and cannot be used in 'valueFields'");s[a[f].trim()]=ko.unwrap(e[a[f].trim()])}for(var f=0;f<u.length;f++)if(u[f].trim()){var l=ko.unwrap(e[u[f].trim()]);if(l){var c=false;for(var h=0;h<o.length;h++)if(o[h]==l){c=true;break}if(!c)o.push(ko.unwrap(e[u[f].trim()]))}}s["tokens"]=o;return s};ko.typeaheadPreFilter=function(e,t,n,r,i,s){var o;var u;if(s&&typeof s=="function"){o=s(e);u=ko.unwrap(o)}else u=ko.unwrap(e);var a=[];if(u){for(var f=0;f<u.length;f++)a.push(ko.typeaheadDatumGenerate(u[f],t,n,r,i))}return a};ko.bindingHandlers.typeahead={update:function(e,t,n,r,i){var s=t();var o=ko.unwrap(s.valueKey);var u=ko.unwrap(s.nameKey)||o;var a=ko.unwrap(s.tokenFields)||"";var f=ko.unwrap(s.valueFields)||"";if(s.hasOwnProperty("selectedDatum")){if(e&&typeof $(e).typeahead=="function"){var l=ko.unwrap(s.selectedDatum);var c=ko.typeaheadDatumGenerate(l,a,f,o,u);var h=$(e).typeahead("getDatum");if(h&&l&&o){if(h[o]!=c[o])$(e).typeahead("setDatum",c);else{if($(e).val()!=c[u])$(e).val(c[u])}}else if(h||c)$(e).typeahead("setDatum",c)}}},init:function(e,t,n,r,i){function wt(e,t){if(e.selectedDatum&&t&&t.hasOwnProperty("data"))e.selectedDatum(t.data);else e.selectedDatum(null)}var s=t();if(!$.isArray(s)){s=[s]}var o=[];var u,a,f,l,c,h,p,d;var v=s.length;for(var m=0;m<v;m++){g=s[m];var g=t();var y=ko.unwrap(g.name);var b=ko.unwrap(g.minLength);var w=ko.unwrap(g.valueKey);var E=ko.unwrap(g.nameKey)||w;var S=ko.unwrap(g.cacheKey);var x=ko.unwrap(g.skipCache);var T=ko.unwrap(g.limit);var N=g.restrictInputToDatum;var C=ko.unwrap(g.template);var k=ko.unwrap(g.templateElement);var L=ko.unwrap(g.tokenFields)||"";var A=ko.unwrap(g.valueFields)||"";var O=ko.unwrap(g.engine);var M=ko.unwrap(g.header);var _=ko.unwrap(g.footer);var D=ko.unwrap(g.local);var P=ko.unwrap(g.matcher);var H=ko.unwrap(g.prefetch);var B=ko.unwrap(g.remote);var j=ko.unwrap(g.url);var F=ko.unwrap(g.ttl);var I=ko.unwrap(g.filter);var q=ko.unwrap(g.dataType);var R=ko.unwrap(g.cache);var U=ko.unwrap(g.timeout);var z=ko.unwrap(g.wildcard);var W=ko.unwrap(g.replace);var X=ko.unwrap(g.rateLimitFn);var V=ko.unwrap(g.rateLimitWait);var J=ko.unwrap(g.maxParallelRequests);var K=ko.unwrap(g.beforeSend);var Q=ko.unwrap(g.handler);var G=ko.unwrap(g.prefetchHandler);var Y=ko.unwrap(g.autoselect);u=g.selectedDatum;a=g.isBusy;f=ko.unwrap(g.onAutoCompleted);l=ko.unwrap(g.onSelected);h=ko.unwrap(g.onOpened);p=ko.unwrap(g.onClosed);d=ko.unwrap(g.onInitialized);c=ko.unwrap(g.onNoSelect);var Z={};if(y)Z.name=y;if(w)Z.valueKey=w;if(!w)$.error("The 'valueKey' opton is requied by this binding handler!");if(E)Z.nameKey=E;if(N)Z.restrictInputToDatum=N;if(S)Z.cacheKey=S;if(T)Z.limit=T;if(b||b===0)Z.minLength=b;if(k)Z.template=$(k).html();else if(C)Z.template=C;if(O)Z.engine=O;if(M)Z.header=M;if(_)Z.footer=_;if(D)Z.local=ko.typeaheadPreFilter(D,L,A,w,E,I);if(P)Z.matcher=P;if(Y||Y===false)Z.autoselect=Y;var et=null;var tt=null;var nt=null;if(H||G){var rt={};function it(e){return ko.typeaheadPreFilter(e,L,A,w,E,et)}if(G)rt.prefetchHandler=G;else if(typeof H=="function")rt.prefetchHandler=H;else if(typeof H=="string"||typeof H=="object"&&H.constructor===String)rt.url=H;else if(typeof H=="object"){tt=ko.unwrap(H.url);nt=ko.unwrap(H.prefetchHandler);var st=ko.unwrap(H.ttl);var ot=ko.unwrap(H.skipCache);et=ko.unwrap(H.filter);if(nt)rt.prefetchHandler=nt;else if(tt)rt.url=tt;if(st)rt.ttl=st;if(ot||ot===false)rt.skipCache=ot}if(I&&!et)et=I;if(G&&!rt.prefetchHandler&&!rt.url)rt.prefetchHandler=G;if(j&&!rt.url)rt.url=j;if(F&&!rt.ttl)rt.ttl=F;if(x&&!(rt.skipCache||rt.skipCache===false))rt.skipCache=x;rt.filter=it;Z.prefetch=rt}if(B||Q){var ut={};if(B&&typeof B=="function")ut.handler=B;else if(Q||typeof Q=="function")ut.handler=Q;else if(Q)ut.url=Q;else if(typeof B=="string"||typeof B=="object"&&B.constructor===String)ut.url=B;else if(typeof B=="object"){tt=ko.unwrap(B.url);nt=ko.unwrap(B.handler);var at=ko.unwrap(B.url);var ft=ko.unwrap(B.cache);var lt=ko.unwrap(B.cacheKey);var ct=ko.unwrap(B.skipCache);var ht=ko.unwrap(B.timeout);var pt=ko.unwrap(B.wildcard);var dt=ko.unwrap(B.replace);var vt=ko.unwrap(B.rateLimitFn);var mt=ko.unwrap(B.rateLimitWait);var gt=ko.unwrap(B.maxParallelRequests);var yt=ko.unwrap(B.beforeSend);et=ko.unwrap(B.filter);if(tt)ut.url=tt;if(at)ut.dataType=at;if(ft)ut.cache=ft;if(ft)ut.cacheKey=lt;if(ct||ct===false)ut.skipCache=ct;if(ht)ut.timeout=ht;if(pt)ut.wildcard=pt;if(dt)ut.replace=dt;if(vt)ut.rateLimitFn=vt;if(mt)ut.rateLimitWait=mt;if(gt)ut.maxParallelRequests=gt;if(yt)ut.beforeSend=yt;if(I&&!et)et=I}function bt(e){return ko.typeaheadPreFilter(e,L,A,w,E,et)}if(j&&!ut.url)ut.url=j;if(Q&&!ut.handler)ut.handler=Q;if(q&&!ut.url)ut.dataType=q;if(R&&!ut.url)ut.cache=R;if(S&&!ut.cacheKey)ut.cacheKey=S;if((x||x===false)&&!ut.skipCache&&ut.skipCache!==false)ut.skipCache=x;if(U&&!ut.timeout)ut.timeout=U;if(z&&!ut.wildcard)ut.wildcard=z;if(W&&!ut.replace)ut.replace=W;if(X&&!ut.rateLimitFn)ut.rateLimitFn=X;if(V&&!ut.rateLimitWait)ut.rateLimitWait=V;if(J&&!ut.maxPerallelRequests)ut.maxParallelRequests=J;if(K&&!ut.beforeSend)ut.beforeSend=K;ut.filter=bt;Z.remote=ut}if(!y)Z.name=e.id;if(Z.template&&!Z.engine&&Hogan)Z.engine=Hogan;Z.tracer=[];o.push(Z)}$(e).attr("autocomplete","off");$(e).typeahead(o);if(f)$(e).on("typeahead:autocompleted",f);if(l)$(e).on("typeahead:selected",l);if(h)$(e).on("typeahead:opened",h);if(p)$(e).on("typeahead:closed",p);if(d)$(e).on("typeahead:initialized",d);if(c)$(e).on("typeahead:noSelect",c);if(u){$(e).on("typeahead:autocompleted typeahead:selected",function(e,n){wt(t(),n)});$(e).on("typeahead:noSelect",function(e,n){wt(t(),null)})}if(a){$(e).on("typeahead:busyUpdate",function(e,n){t().isBusy(n)})}}};
